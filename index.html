<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Gelişmiş Piezoelektrik Şehir Simülasyonu</title>
  <style>
    :root { --accent: #00d2ff; --bg: #f0f2f5; }
    body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: var(--bg); }

    /* Modern UI Paneli */
    #ui-container {
      position: absolute;
      top: 20px; left: 20px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      max-width: 300px;
      pointer-events: auto;
    }

    h2 { margin: 0 0 10px 0; font-size: 18px; color: #2c3e50; }
    .flow-step { font-size: 13px; color: #555; margin-bottom: 5px; display: flex; align-items: center; }
    .flow-step b { color: var(--accent); margin-right: 5px; }

    /* Enerji Barı */
    #energy-meter {
      width: 100%; height: 20px;
      background: #eee; border-radius: 10px;
      margin: 15px 0; overflow: hidden; border: 1px solid #ddd;
    }
    #energy-fill {
      width: 0%; height: 100%;
      background: linear-gradient(90deg, #2ecc71, #27ae60);
      transition: width 0.3s ease;
    }

    /* Kontrol Butonları */
    .btn-group { display: flex; gap: 10px; margin-top: 15px; }
    button {
      flex: 1; padding: 10px; border: none; border-radius: 8px;
      cursor: pointer; font-weight: bold; transition: all 0.2s;
      background: #fff; color: #333; border: 1px solid #ccc;
    }
    button.active { background: #2c3e50; color: white; border-color: #2c3e50; }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

    #hint {
      position: absolute; bottom: 20px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.5); color: white;
      padding: 8px 16px; border-radius: 20px; font-size: 12px;
    }
  </style>
</head>
<body>

<div id="ui-container">
  <h2>Enerji Hasadı</h2>
  <div class="flow-step"><b>1.</b> Basınç Uygula (Tıkla)</div>
  <div class="flow-step"><b>2.</b> Elektriği İlet (Kablolar)</div>
  <div class="flow-step"><b>3.</b> Depola (Batarya)</div>
  <div id="energy-meter"><div id="energy-fill"></div></div>
  <div class="btn-group">
    <button id="dayBtn" class="active" onclick="changeTime('day')">Gündüz</button>
    <button id="nightBtn" onclick="changeTime('night')">Gece</button>
  </div>
</div>
<div id="signature">
  <b>Abidin Mert Doğan</b> | 10/C
<div id="hint">Mouse ile Çevir / Scroll ile Yaklaş / Plakaya Tıkla</div>

<script type="importmap">
  {
      "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
  }
</script>

<script type="module">
  import * as THREE from 'three';
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

  // --- SAHNE AYARLARI ---
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0xdde1e7);

  const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(8, 6, 10);

  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // --- IŞIKLANDIRMA ---
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambientLight);

  const sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
  sunLight.position.set(10, 15, 10);
  sunLight.castShadow = true;
  scene.add(sunLight);

  // --- OBJELER ---
  let energy = 0;
  const groups = { plate: new THREE.Group(), battery: new THREE.Group(), pole: new THREE.Group() };

  // 1. Zemin (Şehir Izgarası gibi)
  const grid = new THREE.GridHelper(20, 20, 0x000000, 0xcccccc);
  grid.position.y = -0.01;
  scene.add(grid);

  // 2. Piezo Plaka (Gelişmiş Material)
  const plateGeo = new THREE.BoxGeometry(3, 0.3, 3);
  const plateMat = new THREE.MeshPhongMaterial({
    color: 0x00d2ff,
    emissive: 0x003344,
    shininess: 100
  });
  const plate = new THREE.Mesh(plateGeo, plateMat);
  plate.position.set(4, 0.15, 0);
  plate.castShadow = true;
  plate.receiveShadow = true;
  scene.add(plate);

  // 3. Batarya (Daha Şık)
  const batGeo = new THREE.CylinderGeometry(0.6, 0.6, 1.8, 32);
  const batMat = new THREE.MeshPhysicalMaterial({
    color: 0xffffff,
    transparent: true,
    opacity: 0.2,
    transmission: 0.9,
    thickness: 0.5
  });
  const batteryShell = new THREE.Mesh(batGeo, batMat);
  batteryShell.position.set(0, 0.9, 0);
  scene.add(batteryShell);

  const energyGeo = new THREE.CylinderGeometry(0.55, 0.55, 1.7, 32);
  const energyMat = new THREE.MeshStandardMaterial({ color: 0x00ff00, emissive: 0x003300 });
  const energyFill = new THREE.Mesh(energyGeo, energyMat);
  energyFill.position.set(0, 0.9, 0);
  energyFill.scale.y = 0.01;
  scene.add(energyFill);

  // 4. Sokak Lambası (Modern Tasarım)
  const poleBase = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.15, 5), new THREE.MeshStandardMaterial({color: 0x333333}));
  poleBase.position.set(-4, 2.5, 0);
  scene.add(poleBase);

  const lampHead = new THREE.Mesh(new THREE.BoxGeometry(1, 0.1, 0.5), new THREE.MeshStandardMaterial({color: 0x222222}));
  lampHead.position.set(-3.5, 5, 0);
  scene.add(lampHead);

  const bulb = new THREE.PointLight(0xffffcc, 0, 15);
  bulb.position.set(-3.5, 4.8, 0);
  scene.add(bulb);
  const bulbGlow = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshBasicMaterial({color: 0x555555}));
  bulbGlow.position.copy(bulb.position);
  scene.add(bulbGlow);

  // 5. Kablolar (Neon Hatlar)
  function createCable(points, color) {
    const curve = new THREE.CatmullRomCurve3(points);
    const tubeGeo = new THREE.TubeGeometry(curve, 20, 0.05, 8, false);
    const tubeMat = new THREE.MeshBasicMaterial({ color: color });
    return new THREE.Mesh(tubeGeo, tubeMat);
  }

  const cable1 = createCable([new THREE.Vector3(2.5, 0.1, 0), new THREE.Vector3(1, 0.1, 0), new THREE.Vector3(0, 0.1, 0)], 0x444444);
  const cable2 = createCable([new THREE.Vector3(0, 0.1, 0), new THREE.Vector3(-4, 0.1, 0), new THREE.Vector3(-4, 1, 0)], 0x444444);
  scene.add(cable1, cable2);

  // --- ETKİLEŞİM MANTIĞI ---
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  window.addEventListener('mousedown', (e) => {
    mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObject(plate);

    if (intersects.length > 0) {
      // Animasyon: Plaka Basılması
      plate.position.y = 0.05;
      if(energy < 100) {
        energy += 8;
        spawnElectron();
      }
      setTimeout(() => plate.position.y = 0.15, 100);
    }
  });

  function spawnElectron() {
    const eGeo = new THREE.SphereGeometry(0.1);
    const eMat = new THREE.MeshBasicMaterial({ color: 0x00d2ff });
    const electron = new THREE.Mesh(eGeo, eMat);
    electron.position.set(4, 0.3, 0);
    scene.add(electron);

    const target = new THREE.Vector3(0, 0.5, 0);
    let progress = 0;
    const speed = 0.05;

    function move() {
      progress += speed;
      electron.position.lerp(target, progress);
      if(progress < 1) requestAnimationFrame(move);
      else scene.remove(electron);
    }
    move();
  }

  // --- ZAMAN MODU ---
  window.changeTime = (mode) => {
    const isNight = mode === 'night';
    document.getElementById('dayBtn').className = isNight ? '' : 'active';
    document.getElementById('nightBtn').className = isNight ? 'active' : '';

    const targetColor = isNight ? new THREE.Color(0x050510) : new THREE.Color(0xdde1e7);
    scene.background = targetColor;
    sunLight.intensity = isNight ? 0.1 : 1.2;
    ambientLight.intensity = isNight ? 0.1 : 0.6;
  };

  // --- RENDER LOOP ---
  function animate() {
    requestAnimationFrame(animate);
    controls.update();

    // Enerji Barı Güncelleme
    const fill = Math.min(energy, 100);
    document.getElementById('energy-fill').style.width = fill + '%';
    energyFill.scale.y = (fill / 100) + 0.01;
    energyFill.position.y = (fill / 100) * 0.85 + 0.1;

    // Gece Işığı Tüketimi
    if(scene.background.getHex() === 0x050510) { // Gece ise
      if(energy > 0) {
        energy -= 0.05;
        bulb.intensity = (energy / 100) * 10;
        bulbGlow.material.color.setHex(0xffff00);
      } else {
        bulb.intensity = 0;
        bulbGlow.material.color.setHex(0x333333);
      }
    } else {
      bulb.intensity = 0;
      bulbGlow.material.color.setHex(0x555555);
    }

    renderer.render(scene, camera);
  }

  animate();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>